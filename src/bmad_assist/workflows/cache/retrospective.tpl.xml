<!--
  Compiled from: retrospective workflow
  Patch: retrospective-automated v2.0.0
  BMAD: 6.0.0-alpha.22
  Compiled at: 2026-01-17T23:08:18.818032+00:00
  Source hash: c18a61b6a6e481fe0b30c6b54784ff8b7005b1ad202d804cd31c07c0eef24857
-->
<workflow-source>
<workflow-yaml>
# Retrospective - Epic Completion Review Workflow
name: "retrospective"
description: "Run after epic completion to review overall success, extract lessons learned, and explore if new information emerged that might impact the next epic"
author: "BMad"

config_source: "{project-root}/_bmad/bmm/config.yaml"
output_folder: "{config_source}:implementation_artifacts}"
user_name: "{config_source}:user_name"
communication_language: "{config_source}:communication_language"
user_skill_level: "{config_source}:user_skill_level"
document_output_language: "{config_source}:document_output_language"
date: system-generated
planning_artifacts: "{config_source}:planning_artifacts"
implementation_artifacts: "{config_source}:implementation_artifacts"

# (paths removed - content embedded)
template: false
instructions: "{installed_path}/instructions.md"

required_inputs:
  - agent_manifest: "{project-root}/_bmad/_config/agent-manifest.csv"

# Smart input file references - handles both whole docs and sharded docs
# Priority: Whole document first, then sharded version
# Strategy: SELECTIVE LOAD - only load the completed epic and relevant retrospectives
input_file_patterns:
  epics:
    description: "The completed epic for retrospective"
    whole: "{planning_artifacts}/*epic*.md"
    sharded_index: "{planning_artifacts}/*epic*/index.md"
    sharded_single: "{planning_artifacts}/*epic*/epic-{{epic_num}}.md"
    load_strategy: "SELECTIVE_LOAD"
  previous_retrospective:
    description: "Previous epic's retrospective (optional)"
    pattern: "{implementation_artifacts}/**/epic-{{prev_epic_num}}-retro-*.md"
    load_strategy: "SELECTIVE_LOAD"
  architecture:
    description: "System architecture for context"
    whole: "{planning_artifacts}/*architecture*.md"
    sharded: "{planning_artifacts}/*architecture*/*.md"
    load_strategy: "FULL_LOAD"
  prd:
    description: "Product requirements for context"
    whole: "{planning_artifacts}/*prd*.md"
    sharded: "{planning_artifacts}/*prd*/*.md"
    load_strategy: "FULL_LOAD"
  document_project:
    description: "Brownfield project documentation (optional)"
    sharded: "{planning_artifacts}/*.md"
    load_strategy: "INDEX_GUIDED"

# Required files
sprint_status_file: "{implementation_artifacts}/"
story_directory: "{implementation_artifacts}"
retrospectives_folder: "{implementation_artifacts}"

standalone: true
</workflow-yaml>
<instructions-xml>
# Retrospective - Epic Completion Review Instructions

<critical>You MUST have already loaded and processed: {project-root}/_bmad/bmm/workflows/4-implementation/retrospective/workflow.yaml</critical>
<critical>Communicate all responses in {communication_language} and language MUST be tailored to {user_skill_level}</critical>
<critical>Generate all documents in {document_output_language}</critical>
<critical>⚠️ ABSOLUTELY NO TIME ESTIMATES - NEVER mention hours, days, weeks, months, or ANY time-based predictions. AI has fundamentally changed development speed - what once took teams weeks/months can now be done by one person in hours. DO NOT give ANY time estimates whatsoever.</critical>

<critical>
SCOPE LIMITATION: You are an AUTOMATED RETROSPECTIVE GENERATOR. Your ONLY output should be a structured retrospective report wrapped in extraction markers. Do NOT use party-mode dialogue. Do NOT wait for user input. Do NOT write files. Generate the complete retrospective in ONE response.
</critical>

<critical>
  DOCUMENT OUTPUT: Retrospective analysis. Concise insights, lessons learned, action items. User skill level ({user_skill_level}) affects conversation style ONLY, not retrospective content.
</critical>

<workflow>

<critical>AUTOMATED MODE: This retrospective runs WITHOUT user interaction.
- Analyze all provided context (epic, stories, sprint-status, previous retro)
- Generate a SINGLE structured retrospective report
- Wrap output in extraction markers
- Do NOT use party-mode dialogue format
- Do NOT wait for user input
- Do NOT save files directly</critical>

<step n="1" goal="Epic Discovery - Find Completed Epic with Priority Logic">

<!-- managed programmatically by bmad-assist -->

<!-- managed programmatically by bmad-assist -->
<action>Read ALL development_status entries</action>
<action>Find the highest epic number with at least one story marked "done"</action>
<action>Extract epic number from keys like "epic-X-retrospective" or story keys like "X-Y-story-name"</action>
<action>Set {{detected_epic}} = highest epic number found with completed stories</action>

<check if="{{detected_epic}} found">
  <action>Set {{epic_number}} = {{detected_epic}}</action>
</check>
<action>Once {{epic_number}} is determined, verify epic completion status</action>

<!-- managed programmatically by bmad-assist -->

<action>Count total stories found for this epic</action>
<action>Count stories with status = "done"</action>
<action>Collect list of pending story keys (status != "done")</action>
<action>Determine if complete: true if all stories are done, false otherwise</action>

<check if="epic is not complete">
<action>Set {{partial_retrospective}} = true</action>
<action>Document incomplete stories for retrospective report</action>
</check>

<check if="epic is complete">
<action>Set {{partial_retrospective}} = false</action>
</check>

</step>

<step n="0.5" goal="Discover and load project documents"><!-- input discovery handled by compiler --><note>After discovery, these content variables are available: {epics_content} (selective load for this epic), {architecture_content}, {prd_content}, {document_project_content}</note>
</step>

<step n="2" goal="Deep Story Analysis - Extract Lessons from Implementation">

<action>For each story in epic {{epic_number}}, read the complete story file from {story_directory}/{{epic_number}}-{{story_num}}-\*.md</action>

<action>Extract and analyze from each story:</action>

**Dev Notes and Struggles:**

- Look for sections like "## Dev Notes", "## Implementation Notes", "## Challenges", "## Development Log"
- Identify where developers struggled or made mistakes
- Note unexpected complexity or gotchas discovered
- Record technical decisions that didn't work out as planned
- Track where estimates were way off (too high or too low)

**Review Feedback Patterns:**

- Look for "## Review", "## Code Review", "## SM Review", "## Scrum Master Review" sections
- Identify recurring feedback themes across stories
- Note which types of issues came up repeatedly
- Track quality concerns or architectural misalignments
- Document praise or exemplary work called out in reviews

**Lessons Learned:**

- Look for "## Lessons Learned", "## Retrospective Notes", "## Takeaways" sections within stories
- Extract explicit lessons documented during development
- Identify "aha moments" or breakthroughs
- Note what would be done differently
- Track successful experiments or approaches

**Technical Debt Incurred:**

- Look for "## Technical Debt", "## TODO", "## Known Issues", "## Future Work" sections
- Document shortcuts taken and why
- Track debt items that affect next epic
- Note severity and priority of debt items

**Testing and Quality Insights:**

- Look for "## Testing", "## QA Notes", "## Test Results" sections
- Note testing challenges or surprises
- Track bug patterns or regression issues
- Document test coverage gaps

<action>Synthesize patterns across all stories:</action>

**Common Struggles:**

- Identify issues that appeared in 2+ stories (e.g., "3 out of 5 stories had API authentication issues")
- Note areas where team consistently struggled
- Track where complexity was underestimated

**Recurring Review Feedback:**

- Identify feedback themes (e.g., "Error handling was flagged in every review")
- Note quality patterns (positive and negative)
- Track areas where team improved over the course of epic

**Breakthrough Moments:**

- Document key discoveries (e.g., "Story 3 discovered the caching pattern we used for rest of epic")
- Note when team velocity improved dramatically
- Track innovative solutions worth repeating

**Velocity Patterns:**

- Calculate average completion time per story
- Note velocity trends (e.g., "First 2 stories took 3x longer than estimated")
- Identify which types of stories went faster/slower

**Team Collaboration Highlights:**

- Note moments of excellent collaboration mentioned in stories
- Track where pair programming or mob programming was effective
- Document effective problem-solving sessions

<action>Store this synthesis - these patterns will drive the retrospective analysis</action>

</step>

<step n="3" goal="Load and Integrate Previous Epic Retrospective">

<action>Calculate previous epic number: {{prev_epic_num}} = {{epic_number}} - 1</action>

<check if="{{prev_epic_num}} >= 1">
  <action>Search for previous retrospective using pattern: {retrospectives_folder}/epic-{{prev_epic_num}}-retro-*.md</action>

  <check if="previous retro found">
    <action>Read the complete previous retrospective file</action>

    <action>Extract key elements:</action>
    - **Action items committed**: What did the team agree to improve?
    - **Lessons learned**: What insights were captured?
    - **Process improvements**: What changes were agreed upon?
    - **Technical debt flagged**: What debt was documented?
    - **Team agreements**: What commitments were made?
    - **Preparation tasks**: What was needed for this epic?

    <action>Cross-reference with current epic execution:</action>

    **Action Item Follow-Through:**
    - For each action item from Epic {{prev_epic_num}} retro, check if it was completed
    - Look for evidence in current epic's story records
    - Mark each action item: ✅ Completed, ⏳ In Progress, ❌ Not Addressed

    **Lessons Applied:**
    - For each lesson from Epic {{prev_epic_num}}, check if team applied it in Epic {{epic_number}}
    - Look for evidence in dev notes, review feedback, or outcomes
    - Document successes and missed opportunities

    **Process Improvements Effectiveness:**
    - For each process change agreed to in Epic {{prev_epic_num}}, assess if it helped
    - Did the change improve velocity, quality, or team satisfaction?
    - Should we keep, modify, or abandon the change?

    **Technical Debt Status:**
    - For each debt item from Epic {{prev_epic_num}}, check if it was addressed
    - Did unaddressed debt cause problems in Epic {{epic_number}}?
    - Did the debt grow or shrink?

    <action>Prepare "continuity insights" for the retrospective report</action>

    <action>Identify wins where previous lessons were applied successfully:</action>
    - Document specific examples of applied learnings
    - Note positive impact on Epic {{epic_number}} outcomes
    - Celebrate team growth and improvement

    <action>Identify missed opportunities where previous lessons were ignored:</action>
    - Document where team repeated previous mistakes
    - Note impact of not applying lessons (without blame)
    - Explore barriers that prevented application

  </check>

  <check if="no previous retro found">
<action>Set {{first_retrospective}} = true</action>
</check>
</check>

<check if="{{prev_epic_num}} < 1">
<action>Set {{first_retrospective}} = true</action>
</check>

</step>

<step n="4" goal="Preview Next Epic with Change Detection">

<action>Calculate next epic number: {{next_epic_num}} = {{epic_number}} + 1</action>

<action>Attempt to load next epic using selective loading strategy:</action>

**Try sharded first (more specific):**
<action>Check if file exists: {planning_artifacts}/epic\*/epic-{{next_epic_num}}.md</action>

<check if="sharded epic file found">
  <action>Load {planning_artifacts}/*epic*/epic-{{next_epic_num}}.md</action>
  <action>Set {{next_epic_source}} = "sharded"</action>
</check>

**Fallback to whole document:**
<check if="sharded epic not found">
<action>Check if file exists: {planning_artifacts}/epic\*.md</action>

  <check if="whole epic file found">
    <action>Load entire epics document</action>
    <action>Extract Epic {{next_epic_num}} section</action>
    <action>Set {{next_epic_source}} = "whole"</action>
  </check>
</check>

<check if="next epic found">
  <action>Analyze next epic for:</action>
  - Epic title and objectives
  - Planned stories and complexity estimates
  - Dependencies on Epic {{epic_number}} work
  - New technical requirements or capabilities needed
  - Potential risks or unknowns
  - Business goals and success criteria

<action>Identify dependencies on completed work:</action>

- What components from Epic {{epic_number}} does Epic {{next_epic_num}} rely on?
- Are all prerequisites complete and stable?
- Any incomplete work that creates blocking dependencies?

<action>Note potential gaps or preparation needed:</action>

- Technical setup required (infrastructure, tools, libraries)
- Knowledge gaps to fill (research, training, spikes)
- Refactoring needed before starting next epic
- Documentation or specifications to create

<action>Check for technical prerequisites:</action>

- APIs or integrations that must be ready
- Data migrations or schema changes needed
- Testing infrastructure requirements
- Deployment or environment setup

<action>Set {{next_epic_exists}} = true</action>
</check>

<check if="next epic NOT found">
<action>Set {{next_epic_exists}} = false</action>
</check>

</step>

<step n="5" goal="Initialize Retrospective Analysis with Rich Context">

<action>Load agent configurations from {agent_manifest}</action>
<action>Identify which agents participated in Epic {{epic_number}} based on story records</action>
<action>Ensure key roles present: Product Owner, Scrum Master (facilitating), Devs, Testing/QA, Architect</action>

<action>Compile epic summary metrics:</action>
- Completed stories count and percentage
- Velocity metrics
- Blocker count
- Technical debt items
- Test coverage info
- Production incidents
- Goals achieved
- Success criteria status

</step>

<step n="6" goal="Epic Review Analysis - What Went Well, What Didn't">

<action>Analyze successes from story records and patterns discovered in Step 2</action>

<action>Identify key success themes:</action>
- Technical wins and breakthroughs
- Quality improvements
- Collaboration highlights
- Process improvements that worked

<action>Analyze challenges from story records and patterns discovered in Step 2</action>

<action>Identify key challenge themes:</action>
- Recurring blockers
- Quality issues
- Communication gaps
- Process problems
- Technical struggles

<action>Synthesize themes from patterns discovered across all stories</action>

<check if="previous retrospective exists">
<action>Analyze action item follow-through from Epic {{prev_epic_num}} retro</action>
<action>Document which items were completed, in progress, or not addressed</action>
<action>Identify impact of following or not following previous lessons</action>
</check>

<action>Create summary of successes, challenges, and key insights</action>

</step>

<step n="7" goal="Next Epic Preparation Analysis">

<check if="{{next_epic_exists}} == false">
  <action>Skip preparation analysis - no next epic defined</action>
  <action>Proceed to Step 8</action>
</check>

<check if="{{next_epic_exists}} == true">

<action>Analyze preparation needs across all dimensions:</action>

- Dependencies on Epic {{epic_number}} work
- Technical setup and infrastructure
- Knowledge gaps and research needs
- Documentation or specification work
- Testing infrastructure
- Refactoring or debt reduction
- External dependencies (APIs, integrations, etc.)

<action>Categorize preparation items:</action>

**CRITICAL PREPARATION (Must complete before epic starts):**
- Items that would block Story 1
- Unresolved technical debt that affects next epic
- Missing infrastructure or tooling

**PARALLEL PREPARATION (Can happen during early stories):**
- Items that only affect later stories
- Non-blocking improvements

**NICE-TO-HAVE PREPARATION (Would help but not blocking):**
- Optimizations
- Documentation improvements
- Nice-to-have tooling

</check>

</step>

<step n="8" goal="Synthesize Action Items with Significant Change Detection">

<action>Synthesize themes from Epic {{epic_number}} review analysis into actionable improvements</action>

<action>Create specific action items with:</action>

- Clear description of the action
- Assigned owner (specific agent or role)
- Category (process, technical, documentation, team, etc.)
- Success criteria (how we'll know it's done)

<action>Ensure action items are SMART:</action>

- Specific: Clear and unambiguous
- Measurable: Can verify completion
- Achievable: Realistic given constraints
- Relevant: Addresses real issues from retro

<action>CRITICAL ANALYSIS - Detect if discoveries require epic updates</action>

<action>Check if any of the following are true based on retrospective analysis:</action>

- Architectural assumptions from planning proven wrong during Epic {{epic_number}}
- Major scope changes or descoping occurred that affects next epic
- Technical approach needs fundamental change for Epic {{next_epic_num}}
- Dependencies discovered that Epic {{next_epic_num}} doesn't account for
- User needs significantly different than originally understood
- Performance/scalability concerns that affect Epic {{next_epic_num}} design
- Security or compliance issues discovered that change approach
- Integration assumptions proven incorrect
- Team capacity or skill gaps more severe than planned
- Technical debt level unsustainable without intervention

<check if="significant discoveries detected">
<action>Document significant changes and their impact</action>
<action>Set {{epic_update_needed}} = true</action>
<action>Identify specific updates needed for Epic {{next_epic_num}}</action>
</check>

<check if="no significant discoveries">
<action>Set {{epic_update_needed}} = false</action>
</check>

</step>

<step n="9" goal="Critical Readiness Assessment">

<action>Assess testing and quality state:</action>
- What verification has been done?
- Are there testing gaps?
- Is Epic {{epic_number}} production-ready from a quality perspective?

<action>Assess deployment and release status:</action>
- Is the work deployed?
- What's the deployment timeline?

<action>Assess stakeholder acceptance:</action>
- Have stakeholders seen and accepted deliverables?
- Is feedback pending?

<action>Assess technical health and stability:</action>
- Is the codebase stable and maintainable?
- Are there lurking concerns?

<action>Identify unresolved blockers:</action>
- Are there blockers from Epic {{epic_number}} carrying forward?
- How do they affect Epic {{next_epic_num}}?

<action>Synthesize readiness assessment with status for each area</action>

</step>

<step n="10" goal="Compile Final Retrospective Data">

<action>Compile all analysis into structured retrospective data:</action>

- Epic summary and metrics
- Team participants
- Successes and strengths identified
- Challenges and growth areas
- Key insights and learnings
- Previous retro follow-through analysis (if applicable)
- Next epic preview and dependencies
- Action items with owners
- Preparation tasks for next epic
- Critical path items
- Significant discoveries and epic update recommendations (if any)
- Readiness assessment
- Commitments and next steps

</step>

<step n="11" goal="Generate Retrospective Report">

<action>Generate comprehensive retrospective report with all compiled data</action>

<action>Output the complete retrospective wrapped in extraction markers:</action>

<!-- RETROSPECTIVE_REPORT_START -->
# Epic {{epic_number}} Retrospective

**Date:** {date}
**Epic:** {{epic_number}} - {{epic_title}}
**Status:** {{#if partial_retrospective}}Partial ({{pending_count}} stories incomplete){{else}}Complete{{/if}}

## Executive Summary

{{executive_summary}}

## Epic Metrics

| Metric | Value |
|--------|-------|
| Stories Completed | {{completed_stories}}/{{total_stories}} ({{completion_percentage}}%) |
| Velocity | {{actual_points}} story points |
| Blockers Encountered | {{blocker_count}} |
| Technical Debt Items | {{debt_count}} |
| Production Incidents | {{incident_count}} |

## Team Participants

{{list_participating_agents}}

## What Went Well

{{#each success_themes}}
### {{this.title}}
{{this.description}}
{{#if this.examples}}
**Examples:**
{{#each this.examples}}
- {{this}}
{{/each}}
{{/if}}
{{/each}}

## Challenges and Growth Areas

{{#each challenge_themes}}
### {{this.title}}
{{this.description}}
{{#if this.root_cause}}
**Root Cause:** {{this.root_cause}}
{{/if}}
{{#if this.impact}}
**Impact:** {{this.impact}}
{{/if}}
{{/each}}

## Key Insights

{{#each key_insights}}
{{@index}}. {{this}}
{{/each}}

{{#if previous_retro_exists}}
## Previous Retrospective Follow-Through

**Epic {{prev_epic_num}} Action Items:**

| Action Item | Status | Notes |
|-------------|--------|-------|
{{#each prev_action_items}}
| {{this.description}} | {{this.status}} | {{this.notes}} |
{{/each}}

**Lessons Applied:**
{{#each lessons_applied}}
- ✅ {{this}}
{{/each}}

**Missed Opportunities:**
{{#each missed_opportunities}}
- ❌ {{this}}
{{/each}}
{{/if}}

{{#if next_epic_exists}}
## Next Epic Preview

**Epic {{next_epic_num}}:** {{next_epic_title}}

### Dependencies on Epic {{epic_number}}
{{#each dependencies}}
- {{this}}
{{/each}}

### Preparation Needed

**Critical (Before Epic Starts):**
{{#each critical_prep}}
- [ ] {{this.description}} - Owner: {{this.owner}}
{{/each}}

**Parallel (During Early Stories):**
{{#each parallel_prep}}
- [ ] {{this.description}} - Owner: {{this.owner}}
{{/each}}

**Nice-to-Have:**
{{#each nice_to_have_prep}}
- [ ] {{this.description}}
{{/each}}
{{/if}}

## Action Items

### Process Improvements
{{#each process_action_items}}
{{@index}}. **{{this.description}}**
   - Owner: {{this.owner}}
   - Success Criteria: {{this.criteria}}
{{/each}}

### Technical Debt
{{#each debt_action_items}}
{{@index}}. **{{this.description}}**
   - Owner: {{this.owner}}
   - Priority: {{this.priority}}
{{/each}}

### Documentation
{{#each doc_action_items}}
{{@index}}. **{{this.description}}**
   - Owner: {{this.owner}}
{{/each}}

### Team Agreements
{{#each team_agreements}}
- {{this}}
{{/each}}

{{#if epic_update_needed}}
## ⚠️ Significant Discoveries - Epic Update Required

The following discoveries from Epic {{epic_number}} require updates to Epic {{next_epic_num}}:

{{#each significant_changes}}
### {{this.title}}
**Discovery:** {{this.description}}
**Impact:** {{this.impact}}
**Recommended Action:** {{this.recommended_action}}
{{/each}}

**IMPORTANT:** Do NOT start Epic {{next_epic_num}} until planning review is complete.
{{/if}}

## Readiness Assessment

| Area | Status | Notes |
|------|--------|-------|
| Testing & Quality | {{quality_status}} | {{quality_notes}} |
| Deployment | {{deployment_status}} | {{deployment_notes}} |
| Stakeholder Acceptance | {{acceptance_status}} | {{acceptance_notes}} |
| Technical Health | {{stability_status}} | {{stability_notes}} |
| Unresolved Blockers | {{blocker_status}} | {{blocker_notes}} |

## Next Steps

1. Review this retrospective summary
2. {{#if epic_update_needed}}Schedule Epic {{next_epic_num}} planning review session{{else}}Execute preparation tasks{{/if}}
3. Complete critical path items before Epic {{next_epic_num}}
4. Review action items in next standup
5. {{#if epic_update_needed}}Update Epic {{next_epic_num}} based on discoveries{{else}}Begin Epic {{next_epic_num}} when preparation complete{{/if}}

---

*Generated by BMAD Retrospective Workflow*
<!-- RETROSPECTIVE_REPORT_END -->

</step>

<step n="12" goal="Final Summary">

<action>Retrospective generation complete</action>
<action>Report is wrapped in extraction markers for orchestrator to parse</action>

</step>

</workflow>

<facilitation-guidelines>
<guideline>Generate structured report only - no dialogue format</guideline>
<guideline>Focus on systems and processes, not individual performance</guideline>
<guideline>Encourage specific examples over general statements</guideline>
<guideline>Balance celebration of wins with honest assessment of challenges</guideline>
<guideline>Action items must be specific, achievable, and owned</guideline>
<guideline>Forward-looking mindset - how do we improve for next epic?</guideline>
<guideline>Deep story analysis provides rich material for report</guideline>
<guideline>Previous retro integration creates accountability and continuity</guideline>
<guideline>Significant change detection prevents epic misalignment</guideline>
<guideline>Critical verification prevents starting next epic prematurely</guideline>
<guideline>Two-part structure ensures both reflection AND preparation</guideline>
<guideline>Output is complete retrospective in single response</guideline>
</facilitation-guidelines>

</instructions-xml>
<output-template>

</output-template>
</workflow-source>