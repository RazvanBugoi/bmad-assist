<!--
  Compiled from: testarch-test-design workflow
  Patch: testarch-test-design-automation v1.0.0
  BMAD: 6.0.0-alpha.22
  Compiled at: 2026-01-31T22:52:12.335024+00:00
  Source hash: 27ce01b8ebf6cae236d14e6d525b1f3d686dc4dae2dcb7624c33e1d698032814
-->
<workflow-source>
<workflow-yaml>
# Test Architect workflow: test-design
name: testarch-test-design
description: "Dual-mode workflow: (1) System-level testability review in Solutioning phase, or (2) Epic-level test planning in Implementation phase. Auto-detects mode based on project phase."
author: "BMad"

# Critical variables from config
config_source: "_bmad/bmm/config.yaml"
output_folder: "{config_source}:output_folder"
user_name: "{config_source}:user_name"
communication_language: "{config_source}:communication_language"
document_output_language: "{config_source}:document_output_language"
date: system-generated

# Workflow components
# (paths removed - content embedded)
# instructions: embedded below
# validation: separate validate workflow
# Note: Template selection is mode-based (see instructions.md Step 1.5):
#   - System-level: test-design-architecture-template.md + test-design-qa-template.md
#   - Epic-level: test-design-template.md (unchanged)
# template: embedded in <output-template>
# Variables and inputs
variables:
  design_level: "full" # full, targeted, minimal - scope of design effort
  mode: "auto-detect" # auto-detect (default), system-level, epic-level

# Output configuration
# Note: Actual output file determined dynamically based on mode detection
# Declared outputs for new workflow format
outputs:
  # System-Level Mode (Phase 3) - TWO documents
  - id: test-design-architecture
    description: "System-level test architecture: Architectural concerns, testability gaps, NFR requirements for Architecture/Dev teams"
    path: "{output_folder}/test-design-architecture.md"
    mode: system-level
    audience: architecture

  - id: test-design-qa
    description: "System-level test design: Test execution recipe, coverage plan, Sprint 0 setup for QA team"
    path: "{output_folder}/test-design-qa.md"
    mode: system-level
    audience: qa

  # Epic-Level Mode (Phase 4) - ONE document (unchanged)
  - id: epic-level
    description: "Epic-level test plan (Phase 4)"
    path: "{output_folder}/test-design-epic-{epic_num}.md"
    mode: epic-level
# Note: No default_output_file - mode detection determines which outputs to write

# Required tools
required_tools:
  - read_file # Read PRD, epics, stories, architecture docs
  - write_file # Create test design document
  - list_files # Find related documentation
  - search_repo # Search for existing tests and patterns

tags:
  - qa
  - planning
  - test-architect
  - risk-assessment
  - coverage

execution_hints:
  interactive: false # Minimize prompts
  autonomous: true # Proceed without user input unless blocked
  iterative: true

web_bundle: false

</workflow-yaml>
<instructions-xml>
<!-- Powered by BMAD-CORE™ -->

# Test Design and Risk Assessment

**Workflow ID**: `_bmad/bmm/testarch/test-design`
**Version**: 5.0 (Step-File Architecture)

---

## CRITICAL SCOPE INSTRUCTION

**SCOPE: You are the TEA (Test Engineer Architect) agent. Create or review test design documentation. Detect level from context: system-level (architecture phase) or epic-level (implementation phase).**

---

## Overview

Plans comprehensive test coverage strategy with risk assessment, priority classification, and execution ordering. This workflow operates in **two modes**:

- **System-Level Mode (Phase 3)**: Testability review of architecture before solutioning gate check
- **Epic-Level Mode (Phase 4)**: Per-epic test planning with risk assessment

The workflow auto-detects which mode to use based on project phase and user intent.

---

## MODE DETECTION LOGIC

Detect design level from context automatically:

- **System-Level Testability Review**: If `architecture.md` is the primary input document, or if the request mentions "architecture review", "testability assessment", or "Phase 3"
- **Epic-Level Test Planning**: If an epic file or story file is provided as input, or if the request mentions specific epic numbers, stories, or "Phase 4"

When mode is ambiguous, examine available inputs:
1. Check for presence of `docs/architecture.md` as primary focus → system-level
2. Check for epic/story references in user request → epic-level
3. If both present, prefer epic-level if specific epic is mentioned

---

## TEST DESIGN KNOWLEDGE APPLICATION

Apply test design knowledge from embedded fragments:

### Risk Governance
- Identify risk areas: business-critical flows, integration points, data integrity, security boundaries
- Classify risks by likelihood and impact
- Map risks to test coverage requirements

### Test Priorities Matrix
- P0 (Critical): Business-critical paths, security, data integrity
- P1 (High): Core functionality, major integrations
- P2 (Medium): Secondary features, edge cases
- P3 (Low): Nice-to-have coverage, exploratory areas

### Test Level Strategy Framework
- **Unit Tests**: Component isolation, fast feedback, >80% code coverage target
- **Integration Tests**: Service boundaries, API contracts, database interactions
- **E2E Tests**: Critical user journeys, cross-system flows, production-like environment

---

## TEST DESIGN CONSIDERATIONS

When creating test design documentation, consider:

1. **Test Levels**
   - Unit test strategy and coverage targets
   - Integration test scope and boundaries
   - E2E test critical path selection

2. **Risk Areas**
   - High-risk components requiring deeper coverage
   - External dependencies and failure modes
   - Data migration and integrity concerns

3. **Coverage Strategy**
   - Code coverage targets by component
   - Feature coverage mapping to requirements
   - Gap analysis against PRD/architecture

4. **Resource Allocation**
   - Test automation vs manual testing split
   - Team capacity and skill requirements
   - Tool and infrastructure needs

---

## OUTPUT GENERATION

Based on detected mode, generate appropriate documentation:

### System-Level Mode Output
Generate `test-design-system.md` (or `test-design-architecture.md` + `test-design-qa.md` per workflow outputs) containing:
- Testability assessment of architecture
- NFR testing requirements
- Infrastructure recommendations
- Sprint 0 test setup checklist

### Epic-Level Mode Output
Generate or update `test-design-epic-{epic_num}.md` containing:
- Epic-specific test scope
- Risk-based test priorities
- Test case outline
- Execution ordering

---

## REQUIRED OUTPUT SECTIONS

All test design documents must include:

1. **Scope**: Clear boundary of what is covered
2. **Test Levels**: Unit, integration, E2E breakdown with rationale
3. **Risk-Based Priorities**: P0-P3 classification with justification
4. **Tooling Recommendations**: Frameworks, libraries, infrastructure
5. **Coverage Strategy**: Targets and measurement approach
6. **Resource Estimates**: Effort and timeline considerations

---

## WORKFLOW ARCHITECTURE

This workflow uses **step-file architecture** for disciplined execution:

### Core Principles

- **Micro-file Design**: Each step is a self-contained instruction file
- **Just-In-Time Loading**: Only the current step file is in memory
- **Sequential Enforcement**: Execute steps in order without skipping
- **State Tracking**: Write outputs only when instructed, then proceed

### Step Processing Rules (Non-Negotiable)

1. **READ COMPLETELY**: Read the entire step file before taking any action
2. **FOLLOW SEQUENCE**: Execute all numbered sections in order
3. **WAIT FOR INPUT**: Halt when user input is required
4. **LOAD NEXT**: Only load the next step file when directed

---

## INITIALIZATION SEQUENCE

### 1. Configuration Loading

From `workflow.yaml`, resolve:

- `config_source`, `output_folder`, `user_name`, `communication_language`, `document_output_language`, `date`

### 2. First Step

Load, read completely, and execute:
`_bmad/bmm/workflows/testarch/test-design/steps-c/step-01-detect-mode.md`

</instructions-xml>
<output-template>

</output-template>
</workflow-source>