<!--
  Compiled from: testarch-trace workflow
  Patch: testarch-trace-automation v1.0.0
  BMAD: 6.0.0-alpha.22
  Compiled at: 2026-02-01T00:47:42.389850+00:00
  Source hash: ccaf74f5de25c67125e25f5f4d9d4866f943f2cbc884d355c0d8bdc97076f770
-->
# Requirements Traceability & Quality Gate

**Workflow:** `testarch-trace`
**Version:** 5.0 (Step-File Architecture)

---

## SCOPE

You are the TEA (Test Engineer Architect) agent. Generate requirements-to-tests traceability matrix and make quality gate decision.

---

## Overview

Create a requirements-to-tests traceability matrix, analyze coverage gaps, and optionally make a gate decision (PASS/CONCERNS/FAIL/WAIVED) based on evidence.

---

## WORKFLOW ARCHITECTURE

This workflow uses **step-file architecture**:

- **Micro-file Design**: Each step is self-contained
- **JIT Loading**: Only the current step file is in memory
- **Sequential Enforcement**: Execute steps in order

---

## INITIALIZATION SEQUENCE

### 1. Configuration Loading

From `workflow.yaml`, resolve:

- `config_source`, `output_folder`, `user_name`, `communication_language`, `document_output_language`, `date`
- `test_dir`, `source_dir`, `coverage_levels`, `gate_type`, `decision_mode`

### 2. First Step

Load, read completely, and execute:
`_bmad/bmm/workflows/testarch/trace/steps-c/step-01-load-context.md`

---

## REQUIREMENTS EXTRACTION

### Source Documents

Extract requirements from the following sources:

1. **PRD**: `docs/prd.md` - Primary product requirements document
2. **Epics**: `docs/epics/` - Epic-level requirements and scope
3. **Story Acceptance Criteria**: Individual story files with detailed criteria

### Requirement Classification

Identify and categorize each requirement:

- **Functional Requirements (FR)**: Features, behaviors, user interactions
- **Non-Functional Requirements (NFR)**: Performance, security, reliability, maintainability

---

## TRACEABILITY MAPPING

### Requirement-to-Test Mapping

For each identified requirement, map to covering tests and classify coverage status:

| Coverage Status | Definition |
|-----------------|------------|
| **Fully Covered** | All acceptance criteria have corresponding test cases |
| **Partially Covered** | Some acceptance criteria tested, gaps remain |
| **Not Covered** | No test cases trace to this requirement |

### Test Discovery Methods

Use test naming conventions and docstrings to establish traceability:

- Test file names matching feature/requirement identifiers
- Describe blocks referencing requirement IDs
- Docstrings with requirement cross-references
- Test tags/markers linking to stories or epics

---

## COVERAGE METRICS

Calculate the following metrics:

1. **Requirements Coverage %**: (Covered Requirements / Total Requirements) Ã— 100
2. **Critical Path Coverage**: Coverage of business-critical user journeys
3. **Risk-Weighted Coverage**: Coverage weighted by requirement priority/risk level

---

## GAP ANALYSIS

Identify coverage gaps and prioritize remediation:

1. List all uncovered or partially covered requirements
2. Assess business impact of each gap
3. Prioritize by: Critical > High > Medium > Low impact
4. Document technical debt and testing risks

---

## QUALITY GATE DECISION

### Decision Criteria

| Decision | Criteria |
|----------|----------|
| **PASS** | All critical requirements covered AND >80% overall coverage |
| **CONCERNS** | Critical requirements covered AND 60-80% overall coverage |
| **FAIL** | Missing critical requirement coverage OR <60% overall coverage |
| **WAIVED** | Documented exceptions with explicit risk acceptance sign-off |

### Decision Process

Based on `decision_mode` configuration:

- **deterministic**: Apply rule-based thresholds automatically
- **manual**: Present evidence and recommend, defer to team decision

---

## OUTPUT FORMAT

### Traceability Matrix

Generate traceability matrix in markdown table format:

```markdown
| Req ID | Requirement Description | Type | Priority | Test IDs | Coverage Status | Notes |
|--------|------------------------|------|----------|----------|-----------------|-------|
| FR-001 | User login with email  | FR   | Critical | T-001, T-002 | Fully Covered | - |
| FR-002 | Password reset flow    | FR   | High     | T-003 | Partially Covered | Missing edge cases |
| NFR-001 | Page load < 2s        | NFR  | Critical | - | Not Covered | Performance tests needed |
```

### Summary Report

Include summary with:

1. **Quality Gate Decision**: PASS / CONCERNS / FAIL / WAIVED
2. **Coverage Statistics**: Overall %, by type, by priority
3. **Gap Summary**: Count and list of uncovered requirements
4. **Recommendations**: Prioritized actions to improve coverage
5. **Risk Assessment**: Documented risks from coverage gaps