
            <!-- Terminal Output (hidden when settings or experiments panel is open) -->
            <div x-show="!settingsView.open && !experimentsView.open"
                 class="flex-1 flex flex-col bg-background overflow-hidden relative">
                <!-- Terminal Header - Controls + Log level filter -->
                <div class="w-full px-4 py-2 border-b border-border">
                    <div class="flex items-center justify-between w-full">
                        <!-- Left: Loop controls -->
                        <div class="flex items-center gap-2">
                            <button class="btn btn-sm"
                                    @click="startLoop"
                                    :disabled="loopRunning || isPaused">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i> Start
                            </button>
                            <!-- Pause button (hidden when paused) -->
                            <button class="btn btn-sm bg-bp-warning text-background hover:bg-bp-warning/80"
                                    @click="pauseLoop"
                                    x-show="!isPaused"
                                    :disabled="!loopRunning"
                                    :class="{ 'opacity-50 cursor-not-allowed': !loopRunning }">
                                <i data-lucide="pause" class="w-3.5 h-3.5"></i> Pause
                            </button>
                            <!-- Resume button (shown when paused) -->
                            <button class="btn btn-sm bg-green-600 text-white hover:bg-green-700"
                                    @click="resumeLoop"
                                    x-show="isPaused"
                                    x-transition
                                    :disabled="!isPaused">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i> Resume
                            </button>
                            <button class="btn btn-sm bg-destructive text-destructive-foreground hover:bg-destructive/80"
                                    @click="stopLoop"
                                    :disabled="!loopRunning">
                                <i data-lucide="square" class="w-3.5 h-3.5"></i> Stop
                            </button>

                            <div class="w-px h-6 bg-border mx-1"></div>

                            <button class="btn-outline btn-sm"
                                    @click="openExperiments()"
                                    :class="{'ring-2 ring-primary': experimentsView.open}"
                                    data-testid="experiments-button">
                                <i data-lucide="flask-conical" class="w-3.5 h-3.5"></i> Experiments
                            </button>
                            <button class="btn-outline btn-sm"
                                    x-ref="settingsBtn"
                                    @click="openSettings()"
                                    :class="{'ring-2 ring-primary': settingsView.open}"
                                    data-testid="settings-button">
                                <i data-lucide="settings" class="w-3.5 h-3.5"></i> Settings
                            </button>
                        </div>

                        <!-- Right: Log level dropdown + Validator progress + Output count -->
                        <div class="flex items-center gap-3">
                            <!-- Output line count -->
                            <span class="text-xs text-muted-foreground tabular-nums"
                                  x-text="`${output.length} lines`"></span>

                            <!-- Log Level Dropdown (state in parent scope to fix reactivity) -->
                            <div class="relative">
                                <button class="flex items-center gap-1 px-2 py-1 text-xs rounded border border-border hover:bg-muted"
                                        @click="logLevelDropdownOpen = !logLevelDropdownOpen"
                                        @click.outside="logLevelDropdownOpen = false"
                                        data-testid="log-level-btn">
                                    <i data-lucide="filter" class="w-3 h-3"></i>
                                    <span x-text="logLevel.toUpperCase()" class="font-mono"></span>
                                    <i data-lucide="chevron-down" class="w-3 h-3"></i>
                                </button>
                                <div x-show="logLevelDropdownOpen"
                                     x-transition:enter="transition ease-out duration-100"
                                     x-transition:enter-start="opacity-0 scale-95"
                                     x-transition:enter-end="opacity-100 scale-100"
                                     x-transition:leave="transition ease-in duration-75"
                                     x-transition:leave-start="opacity-100 scale-100"
                                     x-transition:leave-end="opacity-0 scale-95"
                                     class="absolute top-full right-0 mt-1 w-28 bg-card border border-border rounded-md shadow-lg py-1 z-50"
                                     data-testid="log-level-dropdown">
                                    <button @click="setLogLevel('debug'); logLevelDropdownOpen = false"
                                            class="w-full text-left px-3 py-1 text-xs hover:bg-muted flex items-center justify-between"
                                            :class="{ 'text-primary font-medium': logLevel === 'debug' }">
                                        DEBUG
                                        <i x-show="logLevel === 'debug'" data-lucide="check" class="w-3 h-3"></i>
                                    </button>
                                    <button @click="setLogLevel('info'); logLevelDropdownOpen = false"
                                            class="w-full text-left px-3 py-1 text-xs hover:bg-muted flex items-center justify-between"
                                            :class="{ 'text-primary font-medium': logLevel === 'info' }">
                                        INFO
                                        <i x-show="logLevel === 'info'" data-lucide="check" class="w-3 h-3"></i>
                                    </button>
                                    <button @click="setLogLevel('warning'); logLevelDropdownOpen = false"
                                            class="w-full text-left px-3 py-1 text-xs hover:bg-muted flex items-center justify-between"
                                            :class="{ 'text-primary font-medium': logLevel === 'warning' }">
                                        WARNING
                                        <i x-show="logLevel === 'warning'" data-lucide="check" class="w-3 h-3"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Validator progress indicator -->
                            <div x-show="validatorProgress.total > 0"
                                 x-transition
                                 class="flex items-center gap-2 text-sm text-muted-foreground">
                                <span class="text-xs">Validators:</span>
                                <div class="flex items-center gap-1">
                                    <span x-text="`${validatorProgress.completed + validatorProgress.failed}/${validatorProgress.total}`"
                                          class="tabular-nums"></span>
                                    <span x-show="validatorProgress.failed > 0"
                                          class="text-destructive"
                                          x-text="`(${validatorProgress.failed} failed)`"></span>
                                </div>
                                <div class="w-16 h-1.5 bg-border rounded-full overflow-hidden">
                                    <div class="h-full bg-primary transition-all duration-300"
                                         :style="`width: ${validatorProgressPercent}%`"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- xterm.js Terminal Container -->
                <div class="flex-1 overflow-hidden relative"
                     id="xterm-container"
                     x-ref="xtermContainer"
                     tabindex="0"
                     @wheel="handleTerminalWheel($event)"
                     @keydown="handleTerminalKeydown($event)">
                </div>

                <!-- Auto-scroll indicator -->
                <div x-show="!autoScroll"
                     x-transition:enter="transition ease-out duration-200"
                     x-transition:leave="transition ease-in duration-150"
                     class="absolute bottom-4 right-4 bg-primary text-primary-foreground px-3 py-1 rounded-full text-sm cursor-pointer shadow-lg flex items-center gap-1"
                     title="Click or press End to scroll"
                     @click="autoScroll = true; scrollToBottom()">
                    <i data-lucide="arrow-down" class="w-4 h-4"></i> New output
                </div>
            </div>

